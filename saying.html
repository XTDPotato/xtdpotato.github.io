<!doctype html>
<html lang="zh-CN" class="mdui-theme-auto">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, shrink-to-fit=no"
    />
    <meta name="renderer" content="webkit" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

    <link rel="stylesheet" href="https://unpkg.com/mdui@2.0.3/mdui.css" />
    <script src="https://unpkg.com/mdui@2.0.3/mdui.global.js"></script>

    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet" />

    <title>话说</title>

    <style>
      html,
      body {
        height: 100%;
        margin: 0;
      }

      .page {
        padding: 16px;
        box-sizing: border-box;
        max-width: 920px;
        margin: 0 auto;
        min-height: 100%;
        padding-bottom: 24px;
      }

      .hero {
        display: grid;
        gap: 10px;
      }

      .hero-title {
        font-size: 20px;
        font-weight: 700;
        margin: 0;
      }

      .hero-desc {
        margin: 0;
        opacity: 0.86;
        line-height: 1.6;
      }

      .link-row {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }

      .theme-card-title {
        margin: 0;
        font-weight: 700;
      }

      .palette-grid {
        display: grid;
        grid-template-columns: repeat(6, minmax(0, 1fr));
        gap: 10px;
        padding-top: 10px;
      }

      @media (max-width: 520px) {
        .palette-grid {
          grid-template-columns: repeat(4, minmax(0, 1fr));
        }
      }

      .swatch {
        appearance: none;
        border: 0;
        padding: 0;
        width: 44px;
        height: 44px;
        border-radius: 999px;
        background: var(--swatch-color);
        position: relative;
        cursor: pointer;
        box-shadow:
          0 0 0 1px color-mix(in srgb, currentColor 18%, transparent),
          0 6px 14px rgba(0, 0, 0, 0.18);
        transition: transform 140ms ease, box-shadow 180ms ease;
      }

      .swatch:active {
        transform: scale(0.96);
      }

      .swatch.selected {
        transform: scale(1.06);
        box-shadow:
          0 0 0 3px color-mix(in srgb, rgb(var(--mdui-color-primary, 25 118 210)) 55%, transparent),
          0 10px 18px rgba(0, 0, 0, 0.22);
      }

      .swatch-check {
        position: absolute;
        inset: 0;
        display: grid;
        place-items: center;
        color: #fff;
        opacity: 0;
        transform: scale(0.8);
        transition: opacity 140ms ease, transform 180ms ease;
        filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.35));
      }

      .swatch.selected .swatch-check {
        opacity: 1;
        transform: scale(1);
      }

      #themeFlash {
        position: fixed;
        inset: 0;
        pointer-events: none;
        opacity: 0;
        background: var(--theme-flash-color, transparent);
        transition: opacity 260ms ease;
      }

      body.theme-flash #themeFlash {
        opacity: 0.18;
      }
    </style>
  </head>

  <body>
    <div class="page">
      <mdui-list-subheader id="pageSubheader">话说</mdui-list-subheader>

      <mdui-card variant="outlined" style="width: 100%">
        <div class="mdui-prose" style="padding: 14px">
          <div class="hero">
            <p class="hero-title">欢迎来到 XTDPotato 的中转站</p>
            <p class="hero-desc">
              这里会整理一些我常用的入口、项目与教程。页面持续施工中，UI 正在慢慢补齐。
            </p>
            <div class="link-row">
              <mdui-button variant="tonal" href="https://space.bilibili.com/200264982?" target="_blank">
                <span style="display: inline-flex; align-items: center; gap: 8px">
                  <svg
                    width="18"
                    height="18"
                    viewBox="0 0 18 18"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      fill-rule="evenodd"
                      clip-rule="evenodd"
                      d="M3.73252 2.67094C3.33229 2.28484 3.33229 1.64373 3.73252 1.25764C4.11291 0.890684 4.71552 0.890684 5.09591 1.25764L7.21723 3.30403C7.27749 3.36218 7.32869 3.4261 7.37081 3.49407H10.5789C10.6211 3.4261 10.6723 3.36218 10.7325 3.30403L12.8538 1.25764C13.2342 0.890684 13.8368 0.890684 14.2172 1.25764C14.6175 1.64373 14.6175 2.28484 14.2172 2.67094L13.364 3.49407H14C16.2091 3.49407 18 5.28493 18 7.49407V12.9996C18 15.2087 16.2091 16.9996 14 16.9996H4C1.79086 16.9996 0 15.2087 0 12.9996V7.49406C0 5.28492 1.79086 3.49407 4 3.49407H4.58579L3.73252 2.67094ZM4 5.42343C2.89543 5.42343 2 6.31886 2 7.42343V13.0702C2 14.1748 2.89543 15.0702 4 15.0702H14C15.1046 15.0702 16 14.1748 16 13.0702V7.42343C16 6.31886 15.1046 5.42343 14 5.42343H4ZM5 9.31747C5 8.76519 5.44772 8.31747 6 8.31747C6.55228 8.31747 7 8.76519 7 9.31747V10.2115C7 10.7638 6.55228 11.2115 6 11.2115C5.44772 11.2115 5 10.7638 5 10.2115V9.31747ZM12 8.31747C11.4477 8.31747 11 8.76519 11 9.31747V10.2115C11 10.7638 11.4477 11.2115 12 11.2115C12.5523 11.2115 13 10.7638 13 10.2115V9.31747C13 8.76519 12.5523 8.31747 12 8.31747Z"
                      fill="currentColor"
                    ></path>
                  </svg>
                  <span>B 站主页</span>
                </span>
              </mdui-button>
              <mdui-button variant="tonal" href="https://afdian.com/a/xtdpotato" target="_blank">
                <span style="display: inline-flex; align-items: center; gap: 8px">
                  <span style="width: 18px; height: 18px; display: inline-flex; align-items: center">
                    <img
                      src="https://static.afdiancdn.com/static/img/logo/logo.png"
                      style="width: 18px; height: 18px; display: block; object-fit: contain"
                      alt="爱发电"
                    />
                  </span>
                  <span>爱发电主页</span>
                </span>
              </mdui-button>
            </div>
          </div>
        </div>
      </mdui-card>

      <div style="height: 12px"></div>

      <mdui-card variant="outlined" style="width: 100%">
        <div class="mdui-prose" style="padding: 14px">
          <p class="theme-card-title">主题色</p>
          <div class="palette-grid" id="themePalette"></div>
        </div>
      </mdui-card>
    </div>
    <div id="themeFlash"></div>

    <script>
      const PRIMARY_KEY = "xtd_theme_primary";
      const palette = [
        { name: "Red", color: "#ef5350" },
        { name: "Pink", color: "#ec407a" },
        { name: "Purple", color: "#ab47bc" },
        { name: "Deep Purple", color: "#7e57c2" },
        { name: "Indigo", color: "#5c6bc0" },
        { name: "Blue", color: "#42a5f5" },
        { name: "Cyan", color: "#26c6da" },
        { name: "Teal", color: "#26a69a" },
        { name: "Green", color: "#66bb6a" },
        { name: "Lime", color: "#d4e157" },
        { name: "Amber", color: "#ffca28" },
        { name: "Orange", color: "#ffa726" },
      ];

      const themePalette = document.getElementById("themePalette");
      const themeFlash = document.getElementById("themeFlash");

      function applyColorScheme(color) {
        if (!color || !/^#[0-9a-fA-F]{6}$/.test(color)) return;
        if (window.mdui?.setColorScheme) window.mdui.setColorScheme(color);
      }

      function flash(color) {
        if (!themeFlash) return;
        themeFlash.style.setProperty("--theme-flash-color", color);
        document.body.classList.add("theme-flash");
        setTimeout(() => document.body.classList.remove("theme-flash"), 280);
      }

      function setSelected(color) {
        if (!themePalette) return;
        [...themePalette.querySelectorAll(".swatch")].forEach((btn) => {
          if (btn.dataset.color === color) btn.classList.add("selected");
          else btn.classList.remove("selected");
        });
      }

      function selectColor(color) {
        localStorage.setItem(PRIMARY_KEY, color);
        applyColorScheme(color);
        flash(color);
        setSelected(color);
        try {
          window.parent?.postMessage({ type: "theme:primary", color }, "*");
        } catch (e) {}
      }

      function renderPalette() {
        if (!themePalette) return;
        themePalette.innerHTML = "";
        for (const item of palette) {
          const btn = document.createElement("button");
          btn.type = "button";
          btn.className = "swatch";
          btn.dataset.color = item.color;
          btn.title = item.name;
          btn.style.setProperty("--swatch-color", item.color);
          btn.innerHTML = '<span class="swatch-check"><mdui-icon name="check"></mdui-icon></span>';
          btn.addEventListener("click", () => selectColor(item.color));
          themePalette.appendChild(btn);
        }
      }

      renderPalette();
      const saved = localStorage.getItem(PRIMARY_KEY) || "#7e57c2";
      applyColorScheme(saved);
      setSelected(saved);

      const subheader = document.getElementById("pageSubheader");
      try {
        const parentTopbar = window.parent?.document?.querySelector(".mobile-topbar");
        if (parentTopbar) {
          const style = window.parent.getComputedStyle(parentTopbar);
          if (style.display !== "none") subheader.style.display = "none";
        }
      } catch (e) {}

      window.addEventListener("message", (event) => {
        const data = event?.data;
        if (!data || data.type !== "theme:primary") return;
        const color = data.color;
        if (!color || !/^#[0-9a-fA-F]{6}$/.test(color)) return;
        localStorage.setItem(PRIMARY_KEY, color);
        applyColorScheme(color);
        setSelected(color);
      });

      window.addEventListener("storage", (event) => {
        if (event.key !== PRIMARY_KEY) return;
        const color = event.newValue;
        if (!color || !/^#[0-9a-fA-F]{6}$/.test(color)) return;
        applyColorScheme(color);
        setSelected(color);
      });
    </script>
  </body>
</html>
